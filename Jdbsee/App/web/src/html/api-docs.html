<!DOCTYPE html>
<html>
<head>
<title>JTM API</title>
</head>
<body>
  <h1>API</h1>
  
  
  
  <h2>General</h2>
  <h3>Login</h3>
  <table border="1">
    <tbody>
      <tr>
        <td>Method</td>
        <td><code>POST</code> or <code>GET</code></td>
      </tr>
      <tr>
        <td>Url</td>
        <td><code>/api/login</code></td>
      </tr>
      <tr>
        <td>Request params</td>
        <td><code>username</code>, <code>password</code></td>
      </tr>
      <tr>
        <td>Request body</td>
        <td>empty body</td>
      </tr>
      <tr>
        <td>Response</td>
        <td>empty body; status code either 
          <code>200</code> (successful login) or 
          <code>400</code> (a mandatory field is empty) or 
          <code>401</code> (authorization failure).</td>
      </tr>
    </tbody>
  </table>
  <h4>Example:</h4>
  <table border="1">
    <tbody>
      <tr>
        <th>Request</th>
      </tr>
      <tr>
        <td><code>/api/login?username=admin&password=admin</code></td>
      </tr>
    </tbody>
  </table>

  <h3>Logout</h3>
  <table border="1">
    <tbody>
      <tr>
        <td>Method</td>
        <td><code>POST</code> or <code>GET</code></td>
      </tr>
      <tr>
        <td>Url</td>
        <td><code>/api/logout</code></td>
      </tr>
      <tr>
        <td>Request params</td>
        <td>none</td>
      </tr>
      <tr>
        <td>Request body</td>
        <td>empty body</td>
      </tr>
      <tr>
        <td>Response</td>
        <td>empty body; status <code>200</code> (successful logout).</td>
      </tr>
    </tbody>
  </table>
  <h4>Example:</h4>
  <table border="1">
    <tbody>
      <tr>
        <th>Request</th>
      </tr>
      <tr>
        <td><code>/api/logout</code></td>
      </tr>
    </tbody>
  </table>





  <h2>JDBC</h2>
  <h3>Get list of connection descriptions</h3>
  <table border="1">
    <tbody>
      <tr>
        <td>Method</td>
        <td><code>GET</code></td>
      </tr>
      <tr>
        <td>Url</td>
        <td><code>/api/jdbc/list</code></td>
      </tr>
      <tr>
        <td>Request params</td>
        <td>none</td>
      </tr>
      <tr>
        <td>Request body</td>
        <td>empty body</td>
      </tr>
      <tr>
        <td>Response (application/json UTF-8)</td>
        <td>list of connections</td>
      </tr>
    </tbody>
  </table>
  <h4>Example:</h4>
  <table border="1">
    <tbody>
      <tr>
        <th>Request</th>
        <th>Response</t>
      </tr>
      <tr>
        <td><code>/api/jdbc/list</code></td>
        <td><pre>
{
  "itemList": [
    {
      "location": "Context.ResourceLink-0__Server.Resource-0",
      "active": true,
      "name": "jdbc/MyDataSource",
      "server": "mydbserver.com:1521",
      "db": "MYDATABASE",
      "user": "me",
      "password": "mysecret"
    },
    {
      "location": "Context.ResourceLink-1__Server.Resource-1",
      "active": true,
      "name": "jdbc/YourDataSource",
      "server": "yourdbserver.com:1521",
      "db": "YOURDATABASE",
      "user": "you",
      "password": "yoursecret"
    }
  ]
}       </pre>
        <br /> If there are no connections, the <code>"itemList"</code>
          element will have the value of an empty array:<pre>
{
  "itemList": []
}        </pre>
          <br /> Returning the list under the "itemList" key instead of plain JSON array
          used for maintaining the common response structure with other method responses. 
        </td>
      </tr>
    </tbody>
  </table>

  <h3>Modify connections</h3>
  Modify existing connections
  <table border="1">
    <tbody>
      <tr>
        <td>Method</td>
        <td><code>POST</code></td>
      </tr>
      <tr>
        <td>Url</td>
        <td><code>/api/jdbc/mod</code></td>
      </tr>
      <tr>
        <td>Request params</td>
        <td>none</td>
      </tr>
      <tr>
        <td>Request body</td>
        <td>list of connection modification requests (modRequests),
        where each element is a modRequest consisting of 
        a <code>modRequestId</code> (arbitrary value but unique over the entire list)
        and a <code>modRequestBody</code>, representing one of the three modification requests:
          <table border="1" style="margin: 10px;">
            <tbody>
              <tr>
                <th>Update connection</th>
                <th>Delete connection</th>
                <th>Create connection</th>
              </tr>
              <tr>
                <td><pre>
{
  "action": "update",
  "location": <i>location</i>,
  "data": {
    "active": <i>newValue (optional)</i>,
    "name": <i>newValue (optional)</i>,
    "server": <i>newValue (optional)</i>,
    "db": <i>newValue (optional)</i>,
    "user": <i>newValue (optional)</i>,
    "password": <i>newValue (optional)</i>
  }
}
                </pre></td>
                <td><pre>
{
  "action": "delete",
  "location": <i>location</i>
}
                </pre></td>
                <td><pre>
{
  "action": "create",
  "data": {
    "active": <i>value</i>,
    "name": <i>value</i>,
    "server": <i>value</i>,
    "db": <i>value</i>,
    "user": <i>value</i>,
    "password": <i>value</i>
  }
}
                </pre></td>
              </tr>
            </tbody>
          </table>
        </td>
      </tr>
      <tr>
        <td>Response (application/json UTF-8)</td>
        <td><pre>
{
  "modStatusList": 
      <i>list of statuses corresponding to the list of connection modification requests,  
      where each element is a modStatus consisting of 
      a <code>modRequestId</code> (matching by the <code>modRequestId</code> values from the request),
      a <code>modStatusCode</code>,
      and a <code>modStatusMessage</code> (a description of the status)</i>
       
  "itemList": 
      <i>the full list of connections after all modifications performed, 
      analogous to the response of /api/jdbc/list</i>
}       </pre><br /> The <code>modStatusCode</code> values are:
          <ul>
            <li><code>0</code>: <code>SUCCESS</code></li>
            <li><code>1</code>: <code>ERROR</code>: no connection
              found by <code>"location"</code></li>
            <li><code>2</code>: <code>ERROR</code>: <code>"location"</code>
              is empty</li>
            <li><code>3</code>: <code>ERROR</code>: some mandatory
              fields in <code>"data"</code> are empty</li>
            <li><code>4</code>: <code>ERROR</code>: illegal <code>"action"</code>
              value</li>
            <li><code>5</code>: <code>ERROR</code>: internal error</li>
          </ul>
          If the error occures while parsing the request body JSON, 
          the 400 status will be returned.
          <br/><br/>
          If the requested connection modification list contains
          duplicate or empty <code>modRequestId</code> values, 
          the 400 status will be returned.
        </td>
      </tr>
    </tbody>
  </table>
  <h4>Example:</h4>
  <table border="1">
    <tbody>
      <tr>
        <th>Request</th>
        <th>Response</t>
      </tr>
      <tr>
        <td><pre>
/api/jdbc/mod
[
  {
    "modRequestId": <span style="color: red;">"update_1_1"</span>,
    "modRequestBody": {
      "action": "update",
      "location": "Context.ResourceLink-1__Server.Resource-1",
      "data": {
        "active": false,
        "name": "jdbc/YourNewDataSource",
        "db": "YOURNEWDATABASE",
        "password": "yournewsecret"
      }
    }
  },
  {
    "modRequestId": <span style="color: orange;">"delete_0_0"</span>,
    "modRequestBody": {
      "action": "delete",
      "location": "Context.ResourceLink-0__Server.Resource-0"
    }
  },
  {
    "modRequestId": <span style="color: green;">"create"</span>,
    "modRequestBody": {
      "action": "create",
      "data": {
        "active": true,
        "name": "jdbc/TheirDataSource",
        "server": "theirdbserver.com:1521",
        "db": "THEIRDATABASE",
        "user": "them",
        "password": "theirsecret"
      }
    }
  }
]       </pre></td>
        <td><pre>
{
  "modStatusList": [
    {
      "modRequestId": <span style="color: red;">"update_1_1"</span>,
      "modStatusCode": 0,
      "modStatusMessage": "SUCCESS"
    },
    {
      "modRequestId": <span style="color: orange;">"delete_0_0"</span>,
      "modStatusCode": 0,
      "modStatusMessage": "SUCCESS"
    },
    {
      "modRequestId": <span style="color: green;">"create"</span>,
      "modStatusCode": 0,
      "modStatusMessage": "SUCCESS"
    }
  ],
  
  "itemList": [
    {
      "location": "Context.ResourceLink-0__Server.Resource-1",
      "active": true,
      "name": "jdbc/TheirDataSource",
      "server": "theirdbserver.com:1521",
      "db": "THEIRDATABASE",
      "user": "them",
      "password": "theirsecret"
    },
    {
      "location": "Context.comment-4.ResourceLink-0__Server.Resource-0",
      "active": false,
      "name": "jdbc/YourNewDataSource",
      "server": "yourdbserver.com:1521",
      "db": "YOURNEWDATABASE",
      "user": "you",
      "password": "yournewsecret"
    }
  ]
}  
          </pre></td>
      </tr>
    </tbody>
  </table>
  <h3>Ensure connection</h3>
  Ensures a connection. Unlike modifying, which manipulates existing
  connections only, this method ensures the connection is present after
  invocation. If there is no active connection with the same name, a new
  active connection is created. If there is an active connection with
  the same name, the existing connection becomes inactive, and a new
  active connection is created.
  <table border="1">
    <tbody>
      <tr>
        <td>Method</td>
        <td><code>POST</code></td>
      </tr>
      <tr>
        <td>Url</td>
        <td><code>/api/jdbc/ensure</code></td>
      </tr>
      <tr>
        <td>Request params</td>
        <td>none</td>
      </tr>
      <tr>
        <td>Request body</td>
        <td>A connection description (all fields are mandatory): <pre>
{
  "name": <i>value</i>,
  "server": <i>value</i>,
  "db": <i>value</i>,
  "user": <i>value</i>,
  "password": <i>value</i>
}
          </pre>
        </td>
      </tr>
      <tr>
        <td>Response (application/json UTF-8)</td>
        <td><pre>
{
  "status": <i>status of the request</i>,
  "status_message": <i>status message</i>
}       </pre><br /> The statuses are:
          <ul>
            <li><code>0</code>: <code>SUCCESS</code>: there is an
              entirely same active connection, no modifications
              performed</li>
            <li><code>1</code>: <code>SUCCESS</code>: there has
              been no active connection with the same name, a new active
              connection was created</li>
            <li><code>2</code>: <code>SUCCESS</code>: there has
              been an active connection with the same name, the existing
              connection made inactive, and a new active connection was
              created</li>
            <li><code>3</code>: <code>ERROR</code>: some mandatory
              fields are empty</li>
            <li><code>4</code>: <code>ERROR</code>: internal error</li>
          </ul></td>
      </tr>
    </tbody>
  </table>
  <h4>Example:</h4>
  <table border="1">
    <tbody>
      <tr>
        <th>Request</th>
        <th>Response</t>
      </tr>
      <tr>
        <td><pre>
/api/jdbc/ensure
{
    "name": "jdbc/EnsuredDataSource",
    "server": "theirdbserver.com:1521",
    "db": "ENSUREDDATABASE",
    "user": "ens",
    "password": "ens"
}       </pre></td>
        <td><pre>
{
  "status": 1,
  "status_message": "SUCCESS: there has been no active connection with the same name, a new active connection was created"
}  
          </pre></td>
      </tr>
    </tbody>
  </table>
  
  
  
  
  
  <h2>Ports</h2>
  <h3>Get port description</h3>
  <table border="1">
    <tbody>
      <tr>
        <td>Method</td>
        <td><code>GET</code></td>
      </tr>
      <tr>
        <td>Url</td>
        <td><code>/api/port/ajp13</code></td>
      </tr>
      <tr>
        <td>Request params</td>
        <td><code>type=AJP/1.3</code> or <code>type=HTTP/1.1</code></td>
      </tr>
      <tr>
        <td>Request body</td>
        <td>empty body</td>
      </tr>
      <tr>
        <td>Response (application/json UTF-8)</td>
        <td>port description<br />
        <br />
        If the <code>type</code> request parameter is empty, 
        the 400 status will be returned.
        <br/><br/>
        If the requested <code>type</code> is invalid or no such port defined, 
        the 404 status will be returned.
        </td>
      </tr>
    </tbody>
  </table>
  <h4>Example:</h4>
  <table border="1">
    <tbody>
      <tr>
        <th>Request</th>
        <th>Response</t>
      </tr>
      <tr>
        <td><code>/api/port?type=AJP/1.3</code></td>
        <td><pre>
{
  "type": "AJP/1.3",
  "number": 8009
}       </pre>
        </td>
      </tr>
      <tr>
        <td><code>/api/port?type=HTTP/1.1</code></td>
        <td><pre>
{
  "type": "HTTP/1.1",
  "number": 8080
}       </pre>
        </td>
      </tr>
    </tbody>
  </table>
  
  <h3>Get list of port descriptions</h3>
  <table border="1">
    <tbody>
      <tr>
        <td>Method</td>
        <td><code>GET</code></td>
      </tr>
      <tr>
        <td>Url</td>
        <td><code>/api/port/list</code></td>
      </tr>
      <tr>
        <td>Request params</td>
        <td>none</td>
      </tr>
      <tr>
        <td>Request body</td>
        <td>empty body</td>
      </tr>
      <tr>
        <td>Response (application/json UTF-8)</td>
        <td>list of ports</td>
      </tr>
    </tbody>
  </table>
  <h4>Example:</h4>
  <table border="1">
    <tbody>
      <tr>
        <th>Request</th>
        <th>Response</t>
      </tr>
      <tr>
        <td><code>/api/port/list</code></td>
        <td><pre>
{
  "itemList": [
    {
      "type": "AJP/1.3",
      "port": 8009
    },
    {
      "type": "HTTP/1.1",
      "port": 8080
    }
  ]
}       </pre>
        <br /> If there are no connections, the <code>"itemList"</code>
          element will have the value of an empty array:<pre>
{
  "itemList": []
}        </pre>
          <br /> Returning the list under the "itemList" key instead of plain JSON array
          used for maintaining the common response structure with other method responses.
        </td>
      </tr>
    </tbody>
  </table>
</body>
</html>