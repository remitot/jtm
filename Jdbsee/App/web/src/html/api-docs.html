<!DOCTYPE html>
<html>
<head>
<title>JTM API</title>
</head>
<body>
  <h1>API</h1>
  <h2>General</h2>
  <h3>Login</h3>
  <table border="1">
    <tbody>
      <tr>
        <td>Method</td>
        <td><code>POST</code></td>
      </tr>
      <tr>
        <td>Url</td>
        <td><code>/login</code></td>
      </tr>
      <tr>
        <td>Request params</td>
        <td><code>username</code>, <code>password</code></td>
      </tr>
      <tr>
        <td>Request body</td>
        <td>none</td>
      </tr>
      <tr>
        <td>Response (text/plain UTF-8)</td>
        <td><code>SUCCESS</code> or <code>FAILURE</code></td>
      </tr>
    </tbody>
  </table>
  <h4>Example:</h4>
  <table border="1">
    <tbody>
      <tr>
        <th>Request</th>
        <th>Response</t>
      </tr>
      <tr>
        <td><code>/login?username=admin&password=admin</code></td>
        <td><code>SUCCESS</code></td>
      </tr>
    </tbody>
  </table>

  <h3>Logout</h3>
  <table border="1">
    <tbody>
      <tr>
        <td>Method</td>
        <td><code>POST</code></td>
      </tr>
      <tr>
        <td>Url</td>
        <td><code>/logout</code></td>
      </tr>
      <tr>
        <td>Request params</td>
        <td>none</td>
      </tr>
      <tr>
        <td>Request body</td>
        <td>none</td>
      </tr>
      <tr>
        <td>Response (text/plain UTF-8)</td>
        <td>none</td>
      </tr>
    </tbody>
  </table>
  <h4>Example:</h4>
  <table border="1">
    <tbody>
      <tr>
        <th>Request</th>
      </tr>
      <tr>
        <td><code>/logout</code></td>
      </tr>
    </tbody>
  </table>

  <h2>JDBC</h2>
  <h3>Get list of connections</h3>
  <table border="1">
    <tbody>
      <tr>
        <td>Method</td>
        <td><code>GET</code></td>
      </tr>
      <tr>
        <td>Url</td>
        <td><code>/api/jdbc/list</code></td>
      </tr>
      <tr>
        <td>Request params</td>
        <td>none</td>
      </tr>
      <tr>
        <td>Request body</td>
        <td>none</td>
      </tr>
      <tr>
        <td>Response (application/json UTF-8)</td>
        <td>list of connections</td>
      </tr>
    </tbody>
  </table>
  <h4>Example:</h4>
  <table border="1">
    <tbody>
      <tr>
        <th>Request</th>
        <th>Response</t>
      </tr>
      <tr>
        <td><code>/api/jdbc/list</code></td>
        <td><pre>
{
  "connections": [
    {
      "location": "Context.ResourceLink-0__Server.Resource-0",
      "active": true,
      "name": "jdbc/MyDataSource",
      "server": "mydbserver.com:1521",
      "db": "MYDATABASE",
      "user": "me",
      "password": "mysecret"
    },
    {
      "location": "Context.ResourceLink-1__Server.Resource-1",
      "active": true,
      "name": "jdbc/YourDataSource",
      "server": "yourdbserver.com:1521",
      "db": "YOURDATABASE",
      "user": "you",
      "password": "yoursecret"
    }
  ]
}       </pre><br /> If there are no connections, the <code>"connections"</code>
          element will have the value of an empty array</td>
      </tr>
    </tbody>
  </table>

  <h3>Modify connections</h3>
  Modify existing connections
  <table border="1">
    <tbody>
      <tr>
        <td>Method</td>
        <td><code>POST</code></td>
      </tr>
      <tr>
        <td>Url</td>
        <td><code>/api/jdbc/mod</code></td>
      </tr>
      <tr>
        <td>Request params</td>
        <td>none</td>
      </tr>
      <tr>
        <td>Request body</td>
        <td>list of connection modification requests, where each
          element is one of three modification requests:
          <table border="1" style="margin: 10px;">
            <tbody>
              <tr>
                <th>Update connection</th>
                <th>Delete connection</th>
                <th>Create connection</th>
              </tr>
              <tr>
                <td><pre>
{
  "action": "update",
  "location": <i>location</i>,
  "data": {
    "active": <i>newValue (optional)</i>,
    "name": <i>newValue (optional)</i>,
    "server": <i>newValue (optional)</i>,
    "db": <i>newValue (optional)</i>,
    "user": <i>newValue (optional)</i>,
    "password": <i>newValue (optional)</i>
  }
}
                </pre></td>
                <td><pre>
{
  "action": "delete",
  "location": <i>location</i>
}
                </pre></td>
                <td><pre>
{
  "action": "create",
  "data": {
    "active": <i>newValue</i>,
    "name": <i>newValue</i>,
    "server": <i>newValue</i>,
    "db": <i>newValue</i>,
    "user": <i>newValue</i>,
    "password": <i>newValue</i>
  }
}
                </pre></td>
              </tr>
            </tbody>
          </table>
        </td>
      </tr>
      <tr>
        <td>Response (application/json UTF-8)</td>
        <td><pre>
{
  "mod_states": <i>array of states corresponding to the array of modification requests</i>,
  "connections": <i>the full list of connections after all modifications performed, analogous to the response of /api/jdbc/list</i>
}       </pre><br /> The <code>"mod_states"</code> element is an array of
          states corresponding to the array of modification requests.<br />
          The states are:
          <ul>
            <li><code>0</code>: <code>SUCCESS</code></li>
            <li><code>1</code>: <code>ERROR</code>: no connection
              found by <code>"location"</code></li>
            <li><code>2</code>: <code>ERROR</code>: <code>"location"</code>
              is empty</li>
            <li><code>3</code>: <code>ERROR</code>: some mandatory
              fields in <code>"data"</code> are empty</li>
            <li><code>4</code>: <code>ERROR</code>: illegal <code>"action"</code>
              value</li>
            <li><code>5</code>: <code>ERROR</code>: internal server
              error</li>
          </ul></td>
      </tr>
    </tbody>
  </table>
  <h4>Example:</h4>
  <table border="1">
    <tbody>
      <tr>
        <th>Request</th>
        <th>Response</t>
      </tr>
      <tr>
        <td><pre>
/api/jdbc/mod
{
  "mod_requests": [
    <span style="color: red;">{
      "action": "update",
      "location": "Context.ResourceLink-1__Server.Resource-1",
      "data": {
        "active": false,
        "name": "jdbc/YourNewDataSource",
        "db": "YOURNEWDATABASE",
        "password": "yournewsecret"
      }
    }</span>,
    <span style="color: orange;">{
      "action": "delete",
      "location": "Context.ResourceLink-0__Server.Resource-0"
    }</span>,
    <span style="color: green;">{
      "action": "create",
      "data": {
        "active": true,
        "name": "jdbc/TheirDataSource",
        "server": "theirdbserver.com:1521",
        "db": "THEIRDATABASE",
        "user": "them",
        "password": "theirsecret"
      }
    }</span>
  ]
}       </pre></td>
        <td><pre>
{
  "mod_states": [
    <span style="color: red;">0</span>,
    <span style="color: orange;">0</span>,
    <span style="color: green;">0</span>
  ],
  "connections": [
    {
      "location": "Context.ResourceLink-0__Server.Resource-1",
      "active": true,
      "name": "jdbc/TheirDataSource",
      "server": "theirdbserver.com:1521",
      "db": "THEIRDATABASE",
      "user": "them",
      "password": "theirsecret"
    },
    {
      "location": "Context.comment-4.ResourceLink-0__Server.Resource-0",
      "active": false,
      "name": "jdbc/YourNewDataSource",
      "server": "yourdbserver.com:1521",
      "db": "YOURNEWDATABASE",
      "user": "you",
      "password": "yournewsecret"
    }
  ]
}  
          </pre></td>
      </tr>
    </tbody>
  </table>
  <h3>Ensure connection</h3>
  Ensures a connection. Unlike modifying, which manipulates existing
  connections only, this method ensures the connection is present after
  invocation. If there is no active connection with the same name, a new
  active connection is created. If there is an active connection with
  the same name, the existing connection becomes inactive, and a new
  active connection is created.
  <table border="1">
    <tbody>
      <tr>
        <td>Method</td>
        <td><code>POST</code></td>
      </tr>
      <tr>
        <td>Url</td>
        <td><code>/api/jdbc/ensure</code></td>
      </tr>
      <tr>
        <td>Request params</td>
        <td>none</td>
      </tr>
      <tr>
        <td>Request body</td>
        <td>A connection description (all fields are mandatory): <pre>
{
  "name": <i>value</i>,
  "server": <i>value</i>,
  "db": <i>value</i>,
  "user": <i>value</i>,
  "password": <i>value</i>
}
          </pre>
        </td>
      </tr>
      <tr>
        <td>Response (application/json UTF-8)</td>
        <td><pre>
{
  "ensure_state": <i>state of ensure request</i>,
  "connections": <i>the full list of connections after all modifications performed, analogous to the response of /api/jdbc/list</i>
}       </pre><br /> The states are:
          <ul>
            <li><code>0</code>: <code>SUCCESS</code>: there has
              been an entirely same active connection, no connection has
              been changed</li>
            <li><code>1</code>: <code>SUCCESS</code>: there has
              been no active connection with the same name, a new active
              connection was created</li>
            <li><code>2</code>: <code>SUCCESS</code>: there has
              been an active connection with the same name, the existing
              connection made inactive, and a new active connection was
              created</li>
            <li><code>3</code>: <code>ERROR</code>: some mandatory
              fields are empty</li>
            <li><code>4</code>: <code>ERROR</code>: internal server
              error</li>
          </ul></td>
      </tr>
    </tbody>
  </table>
  <h4>Example:</h4>
  <table border="1">
    <tbody>
      <tr>
        <th>Request</th>
        <th>Response</t>
      </tr>
      <tr>
        <td><pre>
/api/jdbc/ensure
{
    "name": "jdbc/EnsuredDataSource",
    "server": "theirdbserver.com:1521",
    "db": "ENSUREDDATABASE",
    "user": "ens",
    "password": "ens"
}       </pre></td>
        <td><pre>
{
  "ensure_state": 1,
  "connections": [
    {
      "location": "Context.ResourceLink-0__Server.Resource-1",
      "active": true,
      "name": "jdbc/TheirDataSource",
      "server": "theirdbserver.com:1521",
      "db": "THEIRDATABASE",
      "user": "them",
      "password": "theirsecret"
    },
    {
      "location": "Context.comment-4.ResourceLink-0__Server.Resource-0",
      "active": false,
      "name": "jdbc/YourNewDataSource",
      "server": "yourdbserver.com:1521",
      "db": "YOURNEWDATABASE",
      "user": "you",
      "password": "yournewsecret"
    },
    {
      "location": "Context.comment-5.ResourceLink-0__Server.Resource-1",
      "active": true,
      "name": "jdbc/EnsuredDataSource",
      "server": "theirdbserver.com:1521",
      "db": "ENSUREDDATABASE",
      "user": "ens",
      "password": "ens"
    }
  ]
}  
          </pre></td>
      </tr>
    </tbody>
  </table>
</body>
</html>