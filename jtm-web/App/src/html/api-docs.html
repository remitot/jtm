<!DOCTYPE html>
<html>
  <head>
    <title>JTM API</title>
  </head>
  <body>
    <h1>API</h1>
    <h2>General</h2>
    <h3>Login</h3>
    <table border="1">
      <tbody>
        <tr>
          <td>Method</td>
          <td><code>POST</code> or <code>GET</code></td>
        </tr>
        <tr>
          <td>Url</td>
          <td><code>/api/login</code></td>
        </tr>
        <tr>
          <td>Request params</td>
          <td><code>username=<i>username</i></code>, <code>password=<i>password</i></code></td>
        </tr>
        <tr>
          <td>Request body</td>
          <td>empty body</td>
        </tr>
        <tr>
          <td>Response</td>
          <td>empty body
            <br/><br/>
            If login succeeds,
            the 200 status will be returned.
            <br/><br/>
            If either <code>username</code> or <code>password</code> request parameter is empty, 
            the 400 status will be returned.
            <br/><br/>
            If authorization fails, 
            the 401 status will be returned.
          </td>
        </tr>
      </tbody>
    </table>
    <h4>Example:</h4>
    <table border="1">
      <tbody>
        <tr>
          <th>Request</th>
        </tr>
        <tr>
          <td><code>/api/login?username=admin&password=admin</code></td>
        </tr>
      </tbody>
    </table>
    <h3>Logout</h3>
    <table border="1">
      <tbody>
        <tr>
          <td>Method</td>
          <td><code>POST</code> or <code>GET</code></td>
        </tr>
        <tr>
          <td>Url</td>
          <td><code>/api/logout</code></td>
        </tr>
        <tr>
          <td>Request params</td>
          <td>none</td>
        </tr>
        <tr>
          <td>Request body</td>
          <td>empty body</td>
        </tr>
        <tr>
          <td>Response</td>
          <td>empty body
            <br/><br/>
            If logout succeeds,
            the 200 status will be returned.
          </td>
        </tr>
      </tbody>
    </table>
    <h4>Example:</h4>
    <table border="1">
      <tbody>
        <tr>
          <th>Request</th>
        </tr>
        <tr>
          <td><code>/api/logout</code></td>
        </tr>
      </tbody>
    </table>
    <h2>JDBC</h2>
    <h3>Get list of connection descriptions</h3>
    <table border="1">
      <tbody>
        <tr>
          <td>Method</td>
          <td><code>GET</code></td>
        </tr>
        <tr>
          <td>Url</td>
          <td><code>/api/jdbc/list</code></td>
        </tr>
        <tr>
          <td>Request params</td>
          <td>none</td>
        </tr>
        <tr>
          <td>Response (application/json UTF-8)</td>
          <td>list of connection descriptions
            <pre>
{
  "_list": [
    {
      "location": <i>string</i>,
      "active": <i>boolean</i>,
      "name": <i>string</i>,
      "server": <i>string</i>,
      "db": <i>string</i>,
      "user": <i>string</i>,
      "password": <i>string</i>
    },...
  ]
}
            </pre>
            If there are no connections, the <code>"_list"</code>
            element will have the value of an empty array:
            <pre>
{
  "_list": []
}
            </pre>
            Returning the list under the "_list" key instead of plain JSON array
            used for maintaining the common response structure with other method responses.
          </td> 
        </tr>
      </tbody>
    </table>
    <h4>Example:</h4>
    <table border="1">
      <tbody>
        <tr>
          <th>Request</th>
          <th>Response</t>
        </tr>
        <tr>
          <td><code>/api/jdbc/list</code></td>
          <td>
            <pre>
{
  "_list": [
    {
      "location": "Context.ResourceLink-0__Server.Resource-0",
      "active": true,
      "name": "jdbc/MyDataSource",
      "server": "mydbserver.com:1521",
      "db": "MYDATABASE",
      "user": "me",
      "password": "mysecret"
    },
    {
      "location": "Context.ResourceLink-1__Server.Resource-1",
      "active": true,
      "name": "jdbc/YourDataSource",
      "server": "yourdbserver.com:1521",
      "db": "YOURDATABASE",
      "user": "you",
      "password": "yoursecret"
    }
  ]
}
            </pre> 
          </td>
        </tr>
      </tbody>
    </table>
    <h3>Modify connections</h3>
    Modify existing connections
    <table border="1">
      <tbody>
        <tr>
          <td>Method</td>
          <td><code>POST</code></td>
        </tr>
        <tr>
          <td>Url</td>
          <td><code>/api/jdbc/mod</code></td>
        </tr>
        <tr>
          <td>Request params</td>
          <td>none</td>
        </tr>
        <tr>
          <td>Request body</td>
          <td>
            list of connection modification requests (modRequests),
            where each element is a modRequest consisting of 
            a <code>modRequestId</code> (arbitrary value but unique over the entire list)
            and a <code>modRequestBody</code>, representing one of the three modification requests:
            <table border="1" style="margin: 10px;">
              <tbody>
                <tr>
                  <th>Update connection</th>
                  <th>Delete connection</th>
                  <th>Create connection</th>
                </tr>
                <tr>
                  <td>
                    <pre>
{
  "action": "update",
  "location": <i>string</i>,
  "data": {
    "active": <i>boolean (optional)</i>,
    "name": <i>string (optional)</i>,
    "server": <i>string (optional)</i>,
    "db": <i>string (optional)</i>,
    "user": <i>string (optional)</i>,
    "password": <i>string (optional)</i>
  }
}
                </pre>
                  </td>
                  <td>
                    <pre>
{
  "action": "delete",
  "location": <i>string</i>
}
                </pre>
                  </td>
                  <td>
                    <pre>
{
  "action": "create",
  "data": {
    "active": <i>boolean</i>,
    "name": <i>string</i>,
    "server": <i>string</i>,
    "db": <i>string</i>,
    "user": <i>string</i>,
    "password": <i>string</i>
  }
}
                </pre>
                  </td>
                </tr>
              </tbody>
            </table>
          </td>
        </tr>
        <tr>
          <td>Response (application/json UTF-8)</td>
          <td>
            <pre>
{
  "modStatusList": 
      <i>list of statuses corresponding to the list of connection modification requests,  
      where each element is a modStatus consisting of 
      a <code>modRequestId</code> (matching by the <code>modRequestId</code> values from the request),
      a <code>modStatusCode</code>,
      and a <code>modStatusMessage</code> (a description of the status)</i>
       
  "_list": 
      <i>the full list of connections after all modifications performed, 
      analogous to the response of /api/jdbc/list</i>
}       </pre>
            <br /> The <code>modStatusCode</code> values are:
            <ul>
              <li><code>0</code>: <code>SUCCESS</code></li>
              <li><code>1</code>: <code>ERROR</code>: no connection
                found by <code>"location"</code>
              </li>
              <li><code>2</code>: <code>ERROR</code>: <code>"location"</code>
                is empty
              </li>
              <li><code>3</code>: <code>ERROR</code>: some mandatory
                fields in <code>"data"</code> are empty
              </li>
              <li><code>4</code>: <code>ERROR</code>: illegal <code>"action"</code>
                value
              </li>
              <li><code>5</code>: <code>ERROR</code>: internal error</li>
            </ul>
            If the error occures while parsing the request body JSON, 
            the 400 status will be returned.
            <br/><br/>
            If the requested connection modification list contains
            duplicate or empty <code>modRequestId</code> values, 
            the 400 status will be returned.
          </td>
        </tr>
      </tbody>
    </table>
    <h4>Example:</h4>
    <table border="1">
      <tbody>
        <tr>
          <th>Request</th>
          <th>Response</t>
        </tr>
        <tr>
          <td>
            <pre>
/api/jdbc/mod
[
  {
    "modRequestId": <span style="color: red;">"update_1_1"</span>,
    "modRequestBody": {
      "action": "update",
      "location": "Context.ResourceLink-1__Server.Resource-1",
      "data": {
        "active": false,
        "name": "jdbc/YourNewDataSource",
        "db": "YOURNEWDATABASE",
        "password": "yournewsecret"
      }
    }
  },
  {
    "modRequestId": <span style="color: orange;">"delete_0_0"</span>,
    "modRequestBody": {
      "action": "delete",
      "location": "Context.ResourceLink-0__Server.Resource-0"
    }
  },
  {
    "modRequestId": <span style="color: green;">"create"</span>,
    "modRequestBody": {
      "action": "create",
      "data": {
        "active": true,
        "name": "jdbc/TheirDataSource",
        "server": "theirdbserver.com:1521",
        "db": "THEIRDATABASE",
        "user": "them",
        "password": "theirsecret"
      }
    }
  }
]       </pre>
          </td>
          <td>
            <pre>
{
  "modStatusList": [
    {
      "modRequestId": <span style="color: red;">"update_1_1"</span>,
      "modStatusCode": 0,
      "modStatusMessage": "SUCCESS"
    },
    {
      "modRequestId": <span style="color: orange;">"delete_0_0"</span>,
      "modStatusCode": 0,
      "modStatusMessage": "SUCCESS"
    },
    {
      "modRequestId": <span style="color: green;">"create"</span>,
      "modStatusCode": 0,
      "modStatusMessage": "SUCCESS"
    }
  ],
  
  "_list": [
    {
      "location": "Context.ResourceLink-0__Server.Resource-1",
      "active": true,
      "name": "jdbc/TheirDataSource",
      "server": "theirdbserver.com:1521",
      "db": "THEIRDATABASE",
      "user": "them",
      "password": "theirsecret"
    },
    {
      "location": "Context.comment-4.ResourceLink-0__Server.Resource-0",
      "active": false,
      "name": "jdbc/YourNewDataSource",
      "server": "yourdbserver.com:1521",
      "db": "YOURNEWDATABASE",
      "user": "you",
      "password": "yournewsecret"
    }
  ]
}  
          </pre>
          </td>
        </tr>
      </tbody>
    </table>
    <h3>Ensure connection</h3>
    Ensures a connection. Unlike modifying, which manipulates existing
    connections only, this method ensures the connection is present after
    invocation. If there is no active connection with the same name, a new
    active connection is created. If there is an active connection with
    the same name, the existing connection becomes inactive, and a new
    active connection is created.
    <table border="1">
      <tbody>
        <tr>
          <td>Method</td>
          <td><code>POST</code></td>
        </tr>
        <tr>
          <td>Url</td>
          <td><code>/api/jdbc/ensure</code></td>
        </tr>
        <tr>
          <td>Request params</td>
          <td>none</td>
        </tr>
        <tr>
          <td>Request body</td>
          <td>
            A connection description (all fields are mandatory): 
            <pre>
{
  "name": <i>value</i>,
  "server": <i>value</i>,
  "db": <i>value</i>,
  "user": <i>value</i>,
  "password": <i>value</i>
}
          </pre>
          </td>
        </tr>
        <tr>
          <td>Response (application/json UTF-8)</td>
          <td>
            <pre>
{
  "status": <i>status of the request</i>,
  "status_message": <i>status message</i>
}       </pre>
            <br /> The <code>status</code> values are:
            <ul>
              <li><code>0</code>: <code>SUCCESS</code>: there is an
                entirely same active connection, no modifications
                performed
              </li>
              <li><code>1</code>: <code>SUCCESS</code>: there has
                been no active connection with the same name, a new active
                connection was created
              </li>
              <li><code>2</code>: <code>SUCCESS</code>: there has
                been an active connection with the same name, the existing
                connection made inactive, and a new active connection was
                created
              </li>
              <li><code>3</code>: <code>ERROR</code>: some mandatory
                fields are empty
              </li>
              <li><code>4</code>: <code>ERROR</code>: internal error</li>
            </ul>
          </td>
        </tr>
      </tbody>
    </table>
    <h4>Example:</h4>
    <table border="1">
      <tbody>
        <tr>
          <th>Request</th>
          <th>Response</t>
        </tr>
        <tr>
          <td>
            <pre>
/api/jdbc/ensure
{
    "name": "jdbc/EnsuredDataSource",
    "server": "theirdbserver.com:1521",
    "db": "ENSUREDDATABASE",
    "user": "ens",
    "password": "ens"
}       </pre>
          </td>
          <td>
            <pre>
{
  "status": 1,
  "status_message": "SUCCESS: there has been no active connection with the same name, a new active connection was created"
}  
          </pre>
          </td>
        </tr>
      </tbody>
    </table>
    <h2>Ports</h2>
    <h3>Get port number</h3>
    <table border="1">
      <tbody>
        <tr>
          <td>Method</td>
          <td><code>GET</code></td>
        </tr>
        <tr>
          <td>Url</td>
          <td><code>/api/port/http</code> or <code>/api/port/ajp</code></td>
        </tr>
        <tr>
          <td>Request params</td>
          <td>none</td>
        </tr>
        <tr>
          <td>Response (text/plain UTF-8)</td>
          <td>port number<br />
            <br/>
            If the requested <code>type</code> is invalid or no such port defined, 
            the 404 status will be returned.
          </td>
        </tr>
      </tbody>
    </table>
    <h4>Example:</h4>
    <table border="1">
      <tbody>
        <tr>
          <th>Request</th>
          <th>Response</t>
        </tr>
        <tr>
          <td><code>/api/port/http</code></td>
          <td>
            <pre>8080</pre>
          </td>
        </tr>
        <tr>
          <td><code>/api/port/ajp</code></td>
          <td>
            <pre>8009</pre>
          </td>
        </tr>
      </tbody>
    </table>
    <h3>Get list of port descriptions</h3>
    <table border="1">
      <tbody>
        <tr>
          <td>Method</td>
          <td><code>GET</code></td>
        </tr>
        <tr>
          <td>Url</td>
          <td><code>/api/port/list</code></td>
        </tr>
        <tr>
          <td>Request params</td>
          <td>none</td>
        </tr>
        <tr>
          <td>Response (application/json UTF-8)</td>
          <td>list of ports</td>
        </tr>
      </tbody>
    </table>
    <h4>Example:</h4>
    <table border="1">
      <tbody>
        <tr>
          <th>Request</th>
          <th>Response</t>
        </tr>
        <tr>
          <td><code>/api/port/list</code></td>
          <td>
            <pre>
{
  "_list": [
    {
      "type": "AJP/1.3",
      "number": 8009
    },
    {
      "type": "HTTP/1.1",
      "number": 8080
    }
  ]
}       </pre>
            <br /> If there are no connections, the <code>"_list"</code>
            element will have the value of an empty array:
            <pre>
{
  "_list": []
}        </pre>
            <br /> Returning the list under the "_list" key instead of plain JSON array
            used for maintaining the common response structure with other method responses.
          </td>
        </tr>
      </tbody>
    </table>
    <h2>Logs</h2>
    <h3>Get list of log files</h3>
    <table border="1">
      <tbody>
        <tr>
          <td>Method</td>
          <td><code>GET</code></td>
        </tr>
        <tr>
          <td>Url</td>
          <td><code>/api/log/list</code></td>
        </tr>
        <tr>
          <td>Request params</td>
          <td><code>sort=<i>column1,column2,... (optional)</i></code>, <code>tzoffset=<i>client's local time zone offset in minutes (optional)</i></code></td>
        </tr>
        <tr>
          <td>Response (application/json UTF-8)</td>
          <td>list of log files
            <br /><br />
            The <code>sort</code> parameter defines the order of items in the response list.
            The parameter allows a single value or multiple values, comma separated.
            Sorting by multiple columns will be applied subsequently,
            in the order the values are specified. 
            The valid values are: 
            <ul>
              <li><code>+filename</code> or <code>filename</code>: sort ascending by file name</li>
              <li><code>-filename</code>: sort descending by file name</li>
              <li><code>+lastModified</code> or <code>lastModified</code>: sort ascending by the last file modification timestamp</li>
              <li><code>-lastModified</code>: sort descending by the last file modification timestamp</li>
            </ul>
            Missing <code>sort</code> parameter or the empty value equals to 
            <code>sort=-lastModified,+filename</code> parameter. 
            If the invalid <code>sort</code> parameter value provided,
            or the error occures while parsing the values, 
            the 400 status will be returned.
          </td>
        </tr>
      </tbody>
    </table>
    <h4>Example:</h4>
    <table border="1">
      <tbody>
        <tr>
          <th>Request</th>
          <th>Response</t>
        </tr>
        <tr>
          <td><code>/api/log/list</code></td>
          <td>
            <pre>
{
  "_list": [
    {
      "name": "localhost_access_log.2000-01-01.txt",
      "lastModified": 946717200000,
      "lastModifiedDateLocal": "2000-01-01",
      "lastModifiedTimeLocal": "12:00:00",
      "lastModifiedAgo": "31709160",
      "size": 587
    },
    {
      "name": "catalina.out",
      "lastModified": 978426000000,
      "lastModifiedDateLocal": "2001-01-02",
      "lastModifiedTimeLocal": "12:00:00",
      "lastModifiedAgo": "3600",
      "size": 4197
    }
  ]
}       </pre>
            <br /> If there are no log files, the <code>"_list"</code>
            element will have the value of an empty array:
            <pre>
{
  "_list": []
}        </pre>
            <br /> Returning the list under the "_list" key instead of plain JSON array
            used for maintaining the common response structure with other method responses.
          </td>
        </tr>
      </tbody>
    </table>
    <h3>Get log file contents</h3>
    <table border="1">
      <tbody>
        <tr>
          <td>Method</td>
          <td><code>GET</code></td>
        </tr>
        <tr>
          <td>Url</td>
          <td><code>/api/log</code></td>
        </tr>
        <tr>
          <td>Request params</td>
          <td><code>filename=<i>filename</i></code>, <code>inline <i>(optional)</i></code></td>
        </tr>
        <tr>
          <td>Response (text/plain UTF-8)</td>
          <td>log file contents
            <br /><br />
            The <code>inline</code> parameter is boolean: it may have (but does not require) any value.
            If the parameter is present, 
            the response <code>Content-Disposition</code> header will be set to <code>inline</code>,
            otherwise to <code>attachment</code>.
            <br/><br/>
            If the <code>filename</code> request parameter is empty, 
            the 400 status will be returned.
            <br/><br/>
            If the requested <code>filename</code> contains <code>/</code> or <code>\</code> character, 
            the 400 status will be returned (browsing is not allowed).
            <br/><br/>
            If the requested <code>filename</code> does not exist or the file is not readable, 
            the 404 status will be returned.
          </td>
        </tr>
      </tbody>
    </table>
    <h4>Example:</h4>
    <table border="1">
      <tbody>
        <tr>
          <th>Request</th>
          <th>Response</t>
        </tr>
        <tr>
          <td><code>/api/log?filename=localhost_access_log.2001-01-01.txt&inline</code></td>
          <td>
            <pre>
127.0.0.1 - admin [01/Jan/2000:00:00:00 +0300] "GET /application HTTP/1.1" 200 1000
127.0.0.1 - admin [01/Jan/2000:02:00:00 +0300] "GET /application HTTP/1.1" 200 1000
127.0.0.1 - admin [01/Jan/2000:04:00:00 +0300] "GET /application HTTP/1.1" 200 1000
127.0.0.1 - admin [01/Jan/2000:06:00:00 +0300] "GET /application HTTP/1.1" 200 1000
127.0.0.1 - admin [01/Jan/2000:08:00:00 +0300] "GET /application HTTP/1.1" 200 1000
127.0.0.1 - admin [01/Jan/2000:10:00:00 +0300] "GET /application HTTP/1.1" 200 1000
127.0.0.1 - admin [01/Jan/2000:12:00:00 +0300] "GET /application HTTP/1.1" 200 1000
            </pre>
          </td>
        </tr>
      </tbody>
    </table>
  </body>
</html>

